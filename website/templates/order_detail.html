{% extends 'base.html' %}

  {% block content %}
	<div class="jumbotron">
    <h1>
    {% if order_completed %}
    Completed
    {% endif %}
    Order # {{ order.id }}
    </h1>
    <h2><small>({{ order.order_date }})</small></h2>
      {% if valid_order %}

      {% else %}
        {% if order_completed %}
        {% else %}
        <h2 class="text-danger">Uh Oh!</h2>
        <p class="text-danger lead">The following products do not have enough 
        inventory to fufill your order
        <br>
         or have been removed from marketplace:</p>
        <ul>
          {% for product in invalid_products %}
            <li><a href="/products/{{ product.id }}">{{ product.title }}</a></li>
          {% endfor %}
        </ul>
      {% endif %}
      {% endif %}
	</div>

  {% if empty_order %}
    <h4 class="text-warning text-center">No products are on your order!</h4>
  {% else %}



  <table class="table table-striped table-hover">
    <tr>
      <th>Product</th>
      <th class="text-center">Quantity</th>
      <th class="text-right">Price/Unit</th>
      <th class="text-right">Subtotal</th>
      <th></th>
    </tr>
    {% for object in orderproducts %}
      {% if order_completed %}
          <tr>
      {% else %}
        {% if object.0 in invalid_products %}
          <tr class="danger">
        {% else %}
          <tr>
        {% endif %}
      {% endif %}


        <td><a href="/products/{{ object.0.id }}">{{ object.0.title }}</a></td>
        <td class="text-center">{{ object.1 }}</td>
        <td class="text-right">{{ object.0.formatted_price }}</td>
        <td class="text-right">{{ object.2 }}</td>
        <form method="POST" action="{% url 'website:delete_product_from_order' object.0.id order.id %}">
        {% csrf_token %}
        {% if order_completed %}
        {% else %}
        <td class="text-right">
          <input type="submit" value="Delete Product" class="btn btn-xs btn-danger"/>
        </td>
        {% endif %}
      </form>
    </tr>

    {% endfor%}
    <tr>
      <th></th>
      <th></th>
      <th class="text-right">Total :</th>
      <th class="text-right">{{ total_string }}</th>
      <th></th>
    </tr>
  </table>
  {% if order_completed %}
  {% else %}
  <div class="btn-group btn-group-justified" role="group" aria-label="...">
    {% if total > 0 %}
      {% if valid_order %}
        <a href="/completeorder" class="btn btn-info btn-lrg">Complete Order</a>
      {% endif %}

    {% endif %}
    <a href="/deleteorder" class="btn btn-danger">Cancel Order</a>
  </div>
      {% endif %}
  {% endif %}
  {% endblock %}
